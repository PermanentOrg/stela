FROM node:18-alpine
WORKDIR /usr/local/apps/stela/

RUN apk add curl \
    postgresql-client 

COPY package.json .
COPY packages/api/package.json packages/api/
COPY packages/logger/package.json packages/logger/
RUN npm install -g npm@8.19.3
RUN npm cache clean --force
RUN npm install
RUN npm install --dev
ENV PATH=/usr/local/apps/stela/node_modules/.bin:$PATH

WORKDIR /usr/local/apps/stela/

COPY tsconfig.json ./
COPY packages/api/tsconfig.json ./packages/api
COPY packages/api/src ./packages/api/src
COPY packages/logger ./packages/logger

EXPOSE 8080

CMD bash
